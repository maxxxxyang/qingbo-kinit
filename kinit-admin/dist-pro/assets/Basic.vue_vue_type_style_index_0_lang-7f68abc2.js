import{u as e,F as a}from"./useForm-ecbcdb43.js";import{e as o,W as s,A as t,M as l,x as i,E as r,ak as n,N as p,a3 as c,r as m,P as d,dF as u,o as g,l as b,k as f,S as w,ai as _}from"./index-9da7d198.js";import{E as h}from"./el-button-8f21380c.js";import{E as y}from"./el-progress-69812d34.js";import{u as P}from"./useValidator-e352e7a8.js";const I=o({__name:"Basic",props:{tabId:s.number},setup(o){const s=o,{required:I}=P(),{getStorage:v}=w(),x=t(),O=v(x.getToken),j=l([{field:"web_title",label:"系统标题",colProps:{span:24},component:"Input",componentProps:{style:{width:"500px"}}},{field:"web_logo",label:"系统 LOGO",colProps:{span:24},formItemProps:{slots:{default:e=>i(y,{class:"system-settings-basic-image-uploader",action:"/api/vadmin/system/upload/image/to/local",data:{path:"system"},"show-file-list":!1,"before-upload":e=>{const a=["image/jpeg","image/gif","image/png"].includes(e.type),o=e.size/1024/1024<5;return a||d.error("上传LOGO图片必须是 JPG/GIF/PNG/ 格式!"),o||d.error("上传LOGO图片大小不能超过 5MB!"),a&&o},"on-success":a=>{200===a.code?e.web_logo=a.data.remote_path:d.error(a.message)},accept:"image/jpeg,image/gif,image/png",name:"file",headers:{Authorization:O}},{default:()=>[e.web_logo?i("img",{src:e.web_logo,class:"logo-image"},null):i(r,{class:"logo-image-uploader-icon"},{default:()=>[i(n,{icon:"akar-icons:plus",size:23},null)]})]})}}},{field:"web_desc",label:"系统描述",colProps:{span:24},component:"Input",componentProps:{rows:4,type:"textarea",style:{width:"500px"}}},{field:"web_ico",label:"ICO 图标",colProps:{span:24},formItemProps:{slots:{default:e=>i(y,{class:"system-settings-basic-image-uploader",action:"/api/vadmin/system/upload/image/to/local",data:{path:"system"},"show-file-list":!1,"before-upload":e=>{const a=["image/x-icon"].includes(e.type),o=e.size/1024/1024<2;return a||d.error("上传ICO图标必须是 ico 格式!"),o||d.error("上传ICO图标大小不能超过 2MB!"),a&&o},"on-success":a=>{200===a.code?(e.web_ico=a.data.remote_path,e.web_ico_local_path=a.data.local_path):d.error(a.message)},accept:"image/jpeg,image/gif,image/png",name:"file",headers:{Authorization:O}},{default:()=>[e.web_ico?i("img",{src:e.web_ico,class:"ico-image"},null):i(r,{class:"ico-image-uploader-icon"},{default:()=>[i(n,{icon:"akar-icons:plus",size:23},null)]})]})}}},{field:"web_ico_local_path",label:"ICO 图标服务器文件地址",component:"Input",colProps:{span:24},hidden:!0},{field:"web_icp_number",label:"备案号",colProps:{span:24},component:"Input",componentProps:{style:{width:"500px"}}},{field:"web_copyright",label:"版权信息",colProps:{span:24},component:"Input",componentProps:{style:{width:"500px"}}},{field:"active",label:"",colProps:{span:24},formItemProps:{slots:{default:()=>i(c,null,[i(h,{loading:M.value,type:"primary",onClick:A},{default:()=>[p("立即提交")]})])}}}]),k=l({web_title:[I()],web_logo:[I()],web_ico:[I()]}),{formRegister:C,formMethods:F}=e(),{setValues:z,getFormData:G,getElFormExpose:E}=F;let L=m({});const M=m(!1),A=async()=>{const e=await E();if(await(null==e?void 0:e.validate())){const e=await G();if(M.value=!0,!e)return M.value=!1,d.error("未获取到数据");try{const a=await u(e);if(a)return x.setTitle(a.data.web_title||"后台系统"),x.setLogoImage(a.data.web_logo||"/static/system/logo.png"),x.setFooterContent(a.data.web_copyright||"Copyright ©2022-present K"),x.setIcpNumber(a.data.web_icp_number||""),d.success("更新成功")}finally{M.value=!1}}};return(async()=>{const e=await _({tab_id:s.tabId});if(e){await z(e.data),L.value=e.data;const a=await E();null==a||a.clearValidate()}})(),(e,o)=>(g(),b(f(a),{rules:k,onRegister:f(C),schema:j},null,8,["rules","onRegister","schema"]))}});export{I as _};
