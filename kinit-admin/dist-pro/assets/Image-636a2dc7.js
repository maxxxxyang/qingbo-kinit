import{Y as e,e as a,G as t,M as l,x as i,a3 as s,N as o,r,aD as n,P as p,o as u,j as d,m,k as c,ao as _,z as g}from"./index-9da7d198.js";import{u as f,E as v,_ as j}from"./Table.vue_vue_type_script_lang-5256bd69.js";import{E as h}from"./el-button-8f21380c.js";import{a as w,E as y}from"./el-col-d9273186.js";import"./el-image-viewer-83790b35.js";import{_ as x}from"./Search.vue_vue_type_script_setup_true_lang-a57e37eb.js";import{_ as b}from"./ContentWrap.vue_vue_type_script_setup_true_lang-9c7e578a.js";import{_ as k}from"./Write.vue_vue_type_style_index_0_lang-7dff2402.js";import{_ as z}from"./Dialog.vue_vue_type_style_index_0_lang-fcbfdb5d.js";import"./el-message-box-24354127.js";import"./el-input-26eda071.js";import"./event-5568c9d8.js";import"./use-form-item-8b7f5d34.js";import"./use-form-common-props-9d083c67.js";import"./index-cde97138.js";import"./isNil-1f22f7b0.js";import"./el-overlay-037540a2.js";import"./el-checkbox-group-b617b779.js";import"./vnode-ae242abb.js";import"./useForm-ecbcdb43.js";import"./el-tooltip-4ed993c7.js";import"./el-popper-2fae9050.js";import"./el-tag-aef2ce12.js";import"./index-13d6a136.js";import"./el-date-picker-f32b0b71.js";import"./debounce-778af7ed.js";import"./el-switch-7720805d.js";import"./el-divider-fc00d058.js";import"./el-progress-69812d34.js";import"./style.css_vue_type_style_index_0_src_true_lang-0e7f3b44.js";import"./index-14d9f390.js";import"./strings-e2e316bd.js";import"./index-4dbb39b8.js";import"./el-table-column-102f47a6.js";import"./el-dropdown-item-c082162c.js";import"./refs-4f0941bf.js";/* empty css                   */import"./_Uint8Array-bbcc3a61.js";import"./useIcon-6417bbff.js";import"./el-card-5fa288fa.js";import"./useValidator-e352e7a8.js";const R=a=>e.post({url:"/vadmin/resource/images",headersType:"multipart/form-data",data:a}),C=a({name:"ResourceImage",__name:"Image",setup(a){const{t:C}=t(),{tableRegister:D,tableState:P,tableMethods:S}=f({fetchDataApi:async()=>{const{pageSize:a,currentPage:t}=P,l=await(i={page:c(t),limit:c(a),...c($)},e.get({url:"/vadmin/resource/images",params:i}));var i;return{list:l.data||[],total:l.count||0}},fetchDelApi:async a=>{var t;return 200===(await(t=a,e.delete({url:"/vadmin/resource/images",data:t}))).code}}),{dataList:A,loading:U,total:E,pageSize:I,currentPage:L}=P,{getList:V,delList:F}=S,N=l([{field:"selection",type:"selection",show:!0,disabled:!0},{field:"id",label:"编号",show:!0,disabled:!1,align:"center",headerAlign:"center",width:"80px"},{field:"image_url",label:"图片",show:!0,disabled:!0,minWidth:"90px",slots:{default:e=>{const a=e.row;return i(s,null,[i("div",{class:"resource-image-name flex items-center"},[i("div",null,[i(v,{src:`${a.image_url}?x-oss-process=image/resize,m_fixed,h_100`,"zoom-rate":1.2,"preview-src-list":A.value.map((e=>e.image_url)),"preview-teleported":!0,"initial-index":e.$index,style:"height: 60px; display: block",fit:"cover"},null)]),i("div",{class:"leading-[35px] ml-2 truncate"},[i("span",null,[a.filename])])])])}}},{field:"remark",label:"备注",show:!1,disabled:!1},{field:"update_datetime",label:"更新时间",show:!1,width:"180px"},{field:"create_datetime",label:"创建时间",width:"180px",show:!0},{field:"create_user.name",label:"创建人",show:!1},{field:"action",width:"200px",label:"操作",fixed:"right",disabled:!1,show:!0,slots:{default:e=>{const a=e.row;return i(s,null,[i(h,{type:"primary",link:!0,size:"small",onClick:()=>Y(a.id)},{default:()=>[o("复制编号")]}),i(h,{type:"primary",link:!0,size:"small",onClick:()=>Y(a.image_url)},{default:()=>[o("复制链接")]}),i(h,{type:"danger",loading:T.value,link:!0,size:"small",onClick:()=>q(a)},{default:()=>[o("删除")]})])}}}]),W=l([{field:"filename",label:"文件名称",component:"Input",componentProps:{clearable:!1,style:{width:"214px"}}}]),$=r({}),M=e=>{L.value=1,$.value=e,V()},T=r(!1),q=async e=>{T.value=!0,e?await F(!0,[e.id]).finally((()=>{T.value=!1})):await F(!0).finally((()=>{T.value=!1}))},B=r(!1),G=r(""),H=r(),K=r(""),O=r(),Q=r(!1),Y=async e=>{const{copy:a}=n();return await a(e),p.success("复制成功")},J=()=>{G.value="新增图片素材",K.value="add",H.value=void 0,B.value=!0},X=async()=>{const e=c(O),a=await(null==e?void 0:e.submit());if(a){if(Q.value=!0,null==a||a.images.forEach((e=>e.status="uploading")),"2"===(null==a?void 0:a.upload_method))for(const e of null==a?void 0:a.images){const a=new FormData;a.append("file",e.raw),await R(a),e.status="success"}else if("1"===(null==a?void 0:a.upload_method)){const e=null==a?void 0:a.images.map((async e=>{const a=new FormData;a.append("file",e.raw),await R(a),e.status="success"}));await Promise.all(e)}V(),B.value=!1,Q.value=!1}};return(e,a)=>(u(),d(s,null,[i(c(b),null,{default:m((()=>[i(c(x),{schema:W,onReset:M,onSearch:M},null,8,["schema"]),i(c(j),{"current-page":c(L),"onUpdate:currentPage":a[1]||(a[1]=e=>_(L)?L.value=e:null),"page-size":c(I),"onUpdate:pageSize":a[2]||(a[2]=e=>_(I)?I.value=e:null),showAction:"",columns:N,"default-expand-all":"","node-key":"id",data:c(A),loading:c(U),pagination:{total:c(E)},onRegister:c(D),onRefresh:c(V)},{toolbar:m((()=>[i(c(w),{gutter:10},{default:m((()=>[i(c(y),{span:1.5},{default:m((()=>[i(c(h),{type:"primary",onClick:J},{default:m((()=>[o("新增图片素材")])),_:1}),i(c(h),{type:"danger",onClick:a[0]||(a[0]=e=>q(null))},{default:m((()=>[o("批量删除")])),_:1})])),_:1})])),_:1})])),_:1},8,["current-page","page-size","columns","data","loading","pagination","onRegister","onRefresh"])])),_:1}),i(c(z),{modelValue:B.value,"onUpdate:modelValue":a[4]||(a[4]=e=>B.value=e),title:G.value,width:"996px",height:"600px",top:"3vh"},{footer:m((()=>[i(c(h),{type:"primary",loading:Q.value,onClick:X},{default:m((()=>[o(g(c(C)("exampleDemo.save")),1)])),_:1},8,["loading"]),i(c(h),{onClick:a[3]||(a[3]=e=>B.value=!1)},{default:m((()=>[o(g(c(C)("dialogDemo.close")),1)])),_:1})])),default:m((()=>[i(k,{ref_key:"writeRef",ref:O,"current-row":H.value},null,8,["current-row"])])),_:1},8,["modelValue","title"])],64))}});export{C as default};
