import{e,r as a,o as l,j as t,y as s,x as r,m as n,N as i,k as o,z as p,l as u,a3 as d,P as m,ax as c,ay as f}from"./index-9da7d198.js";import{E as _}from"./el-link-d575b38b.js";import{E as y,a as b}from"./el-col-d9273186.js";import{E as v}from"./el-button-8f21380c.js";import{E as g,a as h}from"./el-table-column-102f47a6.js";import"./el-tag-aef2ce12.js";import"./el-tooltip-4ed993c7.js";import{E as w}from"./el-popper-2fae9050.js";import{E as x}from"./el-progress-69812d34.js";import{E as k}from"./el-popconfirm-3191559c.js";/* empty css                   */const j=s("span",null,"导入步骤：",-1),E={style:{"margin-top":"7px"}},z=s("li",{style:{"margin-top":"7px"}},"编辑模板文件，（将需要导入的数据按格式填写进去）",-1),C=s("li",{style:{"margin-top":"7px"}},"上传模板文件，点击确认导入",-1),L=s("li",{style:{"margin-top":"7px"}},"查看导入结果，是否全部导入",-1),X={class:"mt-10px"},M={class:"flex justify-between mr-10px"},B=s("span",null,"导入结果",-1),F={style:{color:"red"}},S=e({__name:"Import",emits:["getList"],setup(e,{emit:S}){const $=e=>{const a=["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(e.type),l=e.size/1024/1024<10;return a||m.error("上传文件必须是 XLSX 格式!"),l||m.error("上传文件大小不能超过 10MB!"),a&&l},q=a(),D=a([]),H=a([]),I=async e=>{D.value=[],D.value.push({filename:e.file.name,filesize:(e.file.size/1024).toFixed(1)+"KB",status:"上传成功"}),q.value=e.file},K=()=>{D.value=[],q.value=null},N=a(!1),P=a(0),R=async()=>{N.value=!0;const e=new FormData;e.append("file",q.value);try{const a=await c(e);a&&(H.value.push({filename:q.value.name,success_number:a.data.success_number,error_number:a.data.error_number,error_url:a.data.error_url}),P.value+=a.data.success_number,K(),S("getList"))}finally{N.value=!1}},A=async()=>{m.info("正在下载请稍等！");const e=await f();if(e){const a=document.createElement("a");a.style.display="none",a.href=e.data.url,a.target="_blank",a.download=e.data.filename;const l=new MouseEvent("click");a.dispatchEvent(l)}};return(e,a)=>(l(),t(d,null,[s("div",null,[j,s("ol",null,[s("li",E,[r(o(_),{onClick:A,target:"_blank",type:"primary"},{default:n((()=>[i(" 下载最新批量导入模板 ")])),_:1})]),z,C,L])]),s("div",null,[r(o(b),{gutter:10,class:"!mt-0 !mr-0"},{default:n((()=>[r(o(y),{span:1.5},{default:n((()=>[s("div",null,[r(o(x),{action:"","http-request":I,data:{path:"users"},"show-file-list":!1,"before-upload":$,accept:".xlsx",disabled:D.value.length>0},{default:n((()=>[r(o(w),{effect:"dark",content:"只支持上传XLSX文件",placement:"top"},{default:n((()=>[r(o(v),{type:"primary",size:"small",disabled:D.value.length>0},{default:n((()=>[i("上传文件")])),_:1},8,["disabled"])])),_:1})])),_:1},8,["disabled"])])])),_:1}),r(o(y),{span:1.5},{default:n((()=>[r(o(v),{type:"primary",size:"small",disabled:0===D.value.length,loading:N.value,onClick:R},{default:n((()=>[i("确认导入")])),_:1},8,["disabled","loading"])])),_:1})])),_:1}),r(o(h),{data:D.value,border:!0,style:{width:"100%"},class:"mt-10px"},{default:n((()=>[r(o(g),{prop:"filename",label:"文件名称",align:"left"}),r(o(g),{prop:"filesize",label:"文件大小",width:"100",align:"center"}),r(o(g),{prop:"status",label:"上传状态",width:"100",align:"center"}),r(o(g),{fixed:"right",label:"操作",width:"130",align:"center"},{default:n((()=>[r(o(k),{title:"确认删除吗?",onConfirm:K},{reference:n((()=>[r(o(v),{link:"",type:"primary",size:"small"},{default:n((()=>[i("删除")])),_:1})])),_:1})])),_:1})])),_:1},8,["data"])]),s("div",X,[s("div",M,[B,s("span",null,"成功导入总数："+p(P.value),1)]),r(o(h),{data:H.value,border:!0,style:{width:"100%"},class:"mt-10px"},{default:n((()=>[r(o(g),{prop:"filename",label:"文件名称",align:"left"}),r(o(g),{prop:"success_number",label:"成功数量",width:"100",align:"center"}),r(o(g),{prop:"error_number",label:"失败数量",width:"100",align:"center"},{default:n((e=>[s("span",F,p(e.row.error_number),1)])),_:1}),r(o(g),{fixed:"right",label:"操作",width:"130",align:"center"},{default:n((e=>[e.row.error_number>0?(l(),u(o(_),{key:0,onClick:a=>(async e=>{m.info("正在下载请稍等！");const a=document.createElement("a");a.style.display="none",a.href=e.error_url,a.target="_blank",a.download=e.filename;const l=new MouseEvent("click");a.dispatchEvent(l)})(e.row),target:"_blank",type:"primary"},{default:n((()=>[i("下载失败数据")])),_:2},1032,["onClick"])):(l(),u(o(_),{key:1,type:"success",underline:!1},{default:n((()=>[i("成功全部导入")])),_:1}))])),_:1})])),_:1},8,["data"])])],64))}});export{S as _};
