import{u as e,F as o}from"./useForm-ecbcdb43.js";import{e as l,L as t,v as s,K as a,r,M as n,x as i,a3 as c,ak as d,w as p,R as u,o as m,l as f,k as h,al as g,S as v,G as w}from"./index-9da7d198.js";import{E as b}from"./el-button-8f21380c.js";import{E as P}from"./el-tag-aef2ce12.js";import{E as y}from"./el-link-d575b38b.js";import{u as j}from"./useValidator-e352e7a8.js";function k(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!g(e)}const x="var(--el-color-primary)",R="#999",I=l({__name:"LoginForm",emits:["to-telephone"],setup(l,{emit:g}){const{required:I}=j(),z=t(),C=s(),{currentRoute:E,addRoute:F,push:_}=a(),{setStorage:L}=v(),{t:q}=w(),S=r(!1),V={telephone:[I()],method:[I()],password:[I()]},A=n([{field:"title",colProps:{span:24},formItemProps:{slots:{default:()=>i("h2",{class:"text-2xl font-bold text-center w-[100%]"},[q("login.login")])}}},{field:"telephone",label:q("login.telephone"),value:"15020221010",component:"Input",colProps:{span:24},componentProps:{style:{width:"100%"},placeholder:q("login.telephonePlaceholder"),maxlength:11}},{field:"password",label:q("login.password"),value:"kinit2022",component:"InputPassword",colProps:{span:24},componentProps:{style:{width:"100%"},placeholder:q("login.passwordPlaceholder")}},{field:"method",label:"登录类型",value:"0",component:"Input",hidden:!0},{field:"tool",colProps:{span:24},formItemProps:{slots:{default:()=>{let e;return i(c,null,[i("div",{class:"flex justify-between items-center w-[100%]"},[i(P,{modelValue:S.value,"onUpdate:modelValue":e=>S.value=e,label:q("login.remember"),size:"small"},null),i(y,{type:"primary",underline:!1},k(e=q("login.forgetPassword"))?e:{default:()=>[e]})])])}}}},{field:"login",colProps:{span:24},formItemProps:{slots:{default:()=>{let e,o;return i(c,null,[i("div",{class:"w-[100%]"},[i(b,{loading:K.value,type:"primary",class:"w-[100%]",onClick:B},k(e=q("login.login"))?e:{default:()=>[e]})]),i("div",{class:"w-[100%] mt-15px"},[i(b,{class:"w-[100%]",onClick:J},k(o=q("login.smsLogin"))?o:{default:()=>[o]})])])}}}},{field:"other",component:"Divider",label:q("login.otherLogin"),componentProps:{contentPosition:"center"}},{field:"otherIcon",colProps:{span:24},formItemProps:{slots:{default:()=>i(c,null,[i("div",{class:"flex justify-between w-[100%]"},[i(d,{icon:"ant-design:github-filled",size:30,class:"cursor-pointer ant-icon",color:R,hoverColor:x},null),i(d,{icon:"ant-design:wechat-filled",size:30,class:"cursor-pointer ant-icon",color:R,hoverColor:x},null),i(d,{icon:"ant-design:alipay-circle-filled",size:30,color:R,hoverColor:x,class:"cursor-pointer ant-icon"},null),i(d,{icon:"ant-design:weibo-circle-filled",size:30,color:R,hoverColor:x,class:"cursor-pointer ant-icon"},null)])])}}}]),{formRegister:D,formMethods:M}=e(),{getFormData:O,getElFormExpose:G}=M,K=r(!1),U=r("");p((()=>E.value),(e=>{var o;U.value=null==(o=null==e?void 0:e.query)?void 0:o.redirect}),{immediate:!0});const B=async()=>{const e=await G();if(await(null==e?void 0:e.validate())){K.value=!0;const e=await O();try{const o=await C.login(e);o?o.data.is_reset_password?H():_({path:"/reset/password"}):K.value=!1}catch(o){K.value=!1}}},H=async()=>{const e=await u();if(e){const o=e.data||[];L("roleRouters",o),await z.generateRoutes(o).catch((()=>{})),z.getAddRouters.forEach((e=>{F(e)})),z.setIsAddRouters(!0),_({path:U.value||z.addRouters[0].path})}},J=()=>{g("to-telephone")};return(e,l)=>(m(),f(h(o),{schema:A,rules:V,"label-position":"top","hide-required-asterisk":"",size:"large",class:"dark:border-1 dark:border-[var(--el-border-color)] dark:border-solid",onRegister:h(D)},null,8,["schema","onRegister"]))}});export{I as _};
