import{u as e,d as o,F as s}from"./useForm-ecbcdb43.js";import{e as a,W as t,G as n,o as i,j as l,l as r,m as d,N as c,z as h,k as u,O as m,a3 as p,r as f,f as g,bq as b,b_ as w,x as v,w as x,a9 as y,n as E,dB as k,dC as S,bX as L}from"./index-9da7d198.js";import{E as j}from"./el-button-8f21380c.js";import{u as R}from"./useIcon-6417bbff.js";const F=a({__name:"ActionButton",props:{showSearch:t.bool.def(!0),showReset:t.bool.def(!0),showExpand:t.bool.def(!1),visible:t.bool.def(!0),searchLoading:t.bool.def(!1),resetLoading:t.bool.def(!1)},emits:["search","reset","expand"],setup(e,{emit:o}){const{t:s}=n(),a=()=>{o("search")},t=()=>{o("reset")},f=()=>{o("expand")};return(o,n)=>(i(),l(p,null,[e.showSearch?(i(),r(u(j),{key:0,type:"primary",loading:e.searchLoading,icon:u(R)({icon:"ep:search"}),onClick:a},{default:d((()=>[c(h(u(s)("common.query")),1)])),_:1},8,["loading","icon"])):m("",!0),e.showReset?(i(),r(u(j),{key:1,loading:e.resetLoading,icon:u(R)({icon:"ep:refresh-right"}),onClick:t},{default:d((()=>[c(h(u(s)("common.reset")),1)])),_:1},8,["loading","icon"])):m("",!0),e.showExpand?(i(),r(u(j),{key:2,icon:u(R)({icon:e.visible?"ep:arrow-down":"ep:arrow-up"}),text:"",onClick:f},{default:d((()=>[c(h(u(s)(e.visible?"common.shrink":"common.expand")),1)])),_:1},8,["icon"])):m("",!0)],64))}}),_=a({__name:"Search",props:{schema:{type:Array,default:()=>[]},isCol:t.bool.def(!1),labelWidth:t.oneOfType([String,Number]).def("auto"),layout:t.string.validate((e=>["inline","bottom"].includes(e))).def("inline"),buttonPosition:t.string.validate((e=>["left","center","right"].includes(e))).def("center"),showSearch:t.bool.def(!0),showReset:t.bool.def(!0),showExpand:t.bool.def(!1),expandField:t.string.def(""),inline:t.bool.def(!0),removeNoValueItem:t.bool.def(!0),model:{type:Object,default:()=>({})},searchLoading:t.bool.def(!1),resetLoading:t.bool.def(!1)},emits:["search","reset","register","validate"],setup(a,{expose:t,emit:n}){const r=a,d=f(!0),c=f(r.model),h=g((()=>{const e=u(N);let o=b(e.schema);if(e.showExpand&&e.expandField&&!u(d)){const s=w(o,(o=>o.field===e.expandField));o.map(((e,o)=>(e.hidden=o>=s,e)))}return"inline"===e.layout&&(o=o.concat([{field:"action",formItemProps:{labelWidth:"0px",slots:{default:()=>v("div",null,[v(F,{showSearch:e.showSearch,showReset:e.showReset,showExpand:e.showExpand,searchLoading:e.searchLoading,resetLoading:e.resetLoading,visible:d.value,onExpand:z,onReset:q,onSearch:W},null)])}}}])),o})),{formRegister:j,formMethods:R}=e(),{getElFormExpose:_,getFormData:O,getFormExpose:C}=R,V=f({}),I=f({}),N=g((()=>{const e={...r};return Object.assign(e,u(I)),e}));x((()=>u(h)),(async(e=[])=>{c.value=o(e,u(c))}),{immediate:!0,deep:!0});const P=async()=>{const e=await O();return u(N).removeNoValueItem?Object.keys(e).reduce(((o,s)=>{const a=e[s];return k(a)||(S(a)?Object.keys(a).length>0&&(o[s]=a):o[s]=a),o}),{}):e},W=async()=>{const e=await _();await(null==e?void 0:e.validate((async e=>{if(e){const e=await P();n("search",e)}})))},q=async()=>{const e=await _();null==e||e.resetFields();const o=await P();n("reset",o)},A=g((()=>({textAlign:u(N).buttonPosition}))),z=async()=>{d.value=!u(d)},B={getElFormExpose:_,setProps:(e={})=>{I.value=Object.assign(u(I),e),V.value=e},setSchema:e=>{const{schema:o}=u(N);for(const s of o)for(const o of e)s.field===o.field&&L(s,o.path,o.value)},setValues:async(e={})=>{c.value=Object.assign(r.model,u(c),e);const o=await C();null==o||o.setValues(e)},delSchema:e=>{const{schema:o}=u(N),s=w(o,(o=>o.field===e));s>-1&&o.splice(s,1)},addSchema:(e,o)=>{const{schema:s}=u(N);void 0===o?s.push(e):s.splice(o,0,e)}};y((()=>{n("register",B)})),t(B);const D=(e,o,s)=>{n("validate",e,o,s)};return(e,o)=>(i(),l(p,null,[v(u(s),{model:c.value,"is-custom":!1,"label-width":N.value.labelWidth,"hide-required-asterisk":"",inline:N.value.inline,"is-col":N.value.isCol,schema:h.value,onRegister:u(j),onValidate:D},null,8,["model","label-width","inline","is-col","schema","onRegister"]),"bottom"===a.layout?(i(),l("div",{key:0,style:E(A.value)},[v(F,{"show-reset":N.value.showReset,"show-search":N.value.showSearch,"show-expand":N.value.showExpand,"search-loading":N.value.searchLoading,"reset-loading":N.value.resetLoading,onExpand:z,onReset:q,onSearch:W},null,8,["show-reset","show-search","show-expand","search-loading","reset-loading"])],4)):m("",!0)],64))}});export{_};
