import{e,G as a,r as t,M as l,x as s,k as i,a3 as o,a8 as r,a6 as u,N as n,aq as p,o as d,j as m,m as c,ao as v,l as _,ar as f,z as g,O as h,as as j,at as w,au as y,P as b,av as x,aw as k}from"./index-9da7d198.js";import{u as P,_ as S}from"./Table.vue_vue_type_script_lang-5256bd69.js";import{E as C}from"./el-button-8f21380c.js";import{E as L}from"./el-switch-7720805d.js";import{a as z,E as R}from"./el-col-d9273186.js";import{_ as A}from"./Search.vue_vue_type_script_setup_true_lang-a57e37eb.js";import{_ as G}from"./ContentWrap.vue_vue_type_script_setup_true_lang-9c7e578a.js";import{_ as U}from"./Write.vue_vue_type_script_setup_true_lang-b4f22a6b.js";import{_ as D}from"./Dialog.vue_vue_type_style_index_0_lang-fcbfdb5d.js";import{s as E}from"./dict-ab5a6743.js";import{u as I}from"./dict-b6f9162a.js";import{_ as V}from"./Import.vue_vue_type_script_setup_true_lang-7dc203dd.js";import{_ as M}from"./PasswordSendSMS.vue_vue_type_script_setup_true_lang-007e3bf1.js";import{_ as N}from"./PasswordSendEmail.vue_vue_type_script_setup_true_lang-5a56f3de.js";import"./el-message-box-24354127.js";import"./el-input-26eda071.js";import"./event-5568c9d8.js";import"./use-form-item-8b7f5d34.js";import"./use-form-common-props-9d083c67.js";import"./index-cde97138.js";import"./isNil-1f22f7b0.js";import"./el-overlay-037540a2.js";import"./el-checkbox-group-b617b779.js";import"./vnode-ae242abb.js";import"./useForm-ecbcdb43.js";import"./el-tooltip-4ed993c7.js";import"./el-popper-2fae9050.js";import"./el-tag-aef2ce12.js";import"./index-13d6a136.js";import"./el-date-picker-f32b0b71.js";import"./debounce-778af7ed.js";import"./el-divider-fc00d058.js";import"./el-progress-69812d34.js";import"./style.css_vue_type_style_index_0_src_true_lang-0e7f3b44.js";import"./index-14d9f390.js";import"./strings-e2e316bd.js";import"./index-4dbb39b8.js";import"./el-table-column-102f47a6.js";import"./el-image-viewer-83790b35.js";import"./el-dropdown-item-c082162c.js";import"./refs-4f0941bf.js";/* empty css                   */import"./_Uint8Array-bbcc3a61.js";import"./useIcon-6417bbff.js";import"./el-card-5fa288fa.js";import"./useValidator-e352e7a8.js";import"./role-6b68436c.js";import"./dict-b26f862b.js";import"./el-link-d575b38b.js";import"./el-popconfirm-3191559c.js";const O=e({name:"AuthUser",__name:"User",setup(e){const{t:O}=a(),{tableRegister:W,tableState:q,tableMethods:Q}=P({fetchDataApi:async()=>{const{pageSize:e,currentPage:a}=q,t=await j({page:i(a),limit:i(e),...i(te)});return{list:t.data||[],total:t.count||0}},fetchDelApi:async e=>200===(await w(e)).code,fetchExportApi:async e=>{const{pageSize:a,currentPage:t}=q;return await y({page:i(t),limit:i(a),...i(te)},e)}}),{dataList:T,loading:$,total:B,pageSize:F,currentPage:H}=q,{getList:K,delList:X,getSelections:Y,exportQueryList:Z}=Q,J=t([]);(async()=>{const e=I(),a=await e.getDictObj(["sys_vadmin_gender"]);J.value=a.sys_vadmin_gender})();const ee=l([{field:"selection",type:"selection",show:!0,disabled:!0},{field:"id",label:"用户编号",width:"100px",show:!0,disabled:!0},{field:"name",label:"姓名",show:!0,disabled:!0},{field:"nickname",label:"昵称",show:!0},{field:"telephone",label:"手机号",show:!0,disabled:!0},{field:"email",label:"邮箱",show:!0,disabled:!0},{field:"gender",label:"性别",show:!0,slots:{default:e=>{const a=e.row;return s(o,null,[s("div",null,[E(i(J),a.gender)])])}}},{field:"roles",label:"角色",show:!0,slots:{default:e=>{const a=e.row;return s(o,null,[s("div",{class:"text-truncate"},[a.roles.map((e=>e.name)).join()])])}}},{field:"is_active",label:"是否可用",show:!0,slots:{default:e=>{const a=e.row;return s(o,null,[s(L,{value:a.is_active,disabled:!0},null)])}}},{field:"is_staff",label:"工作人员",show:!0,slots:{default:e=>{const a=e.row;return s(o,null,[s(L,{value:a.is_staff,disabled:!0},null)])}}},{field:"last_login",label:"最近登录时间",show:!0,width:"190px"},{field:"create_datetime",label:"创建时间",width:"190px",show:!0},{field:"action",width:"150px",label:"操作",show:!0,slots:{default:e=>{const a=e.row;return s(o,null,[r(s(C,{type:"primary",link:!0,size:"small",onClick:()=>me(a)},{default:()=>[n("编辑")]}),[[u("hasPermi"),["auth.user.update"]]]),r(s(C,{type:"danger",loading:se.value,link:!0,size:"small",onClick:()=>ie(a)},{default:()=>[n("删除")]}),[[u("hasPermi"),["auth.user.delete"]]])])}}}]),ae=l([{field:"name",label:"姓名",component:"Input",componentProps:{clearable:!1,style:{width:"214px"}},formItemProps:{labelWidth:"47px"}},{field:"telephone",label:"手机号",component:"Input",componentProps:{clearable:!1,style:{width:"214px"}}},{field:"is_active",label:"状态",component:"Select",componentProps:{style:{width:"214px"},options:[{label:"正常",value:!0},{label:"停用",value:!1}]}},{field:"is_staff",label:"工作人员",component:"Select",componentProps:{style:{width:"214px"},options:[{label:"是",value:!0},{label:"否",value:!1}]}}]),te=t({}),le=e=>{H.value=1,te.value=e,K()},se=t(!1),ie=async e=>{se.value=!0,e?await X(!0,[e.id]).finally((()=>{se.value=!1})):await X(!0).finally((()=>{se.value=!1}))},oe=t(!1),re=t(""),ue=t(),ne=t(""),pe=t(),de=t(!1),me=async e=>{const a=await p(e.id);a&&(re.value="编辑用户",a.data.role_ids=a.data.roles.map((e=>e.id)),ne.value="edit",ue.value=a.data,oe.value=!0)},ce=()=>{re.value="新增用户",ne.value="add",ue.value=void 0,oe.value=!0},ve=()=>{re.value="批量导入用户",ne.value="import",ue.value=void 0,oe.value=!0},_e=t([]),fe=async()=>{if(_e.value=await Y(),!(_e.value.length>0))return b.warning("请先选择数据");re.value="重置密码并发送短信",ne.value="sms",ue.value=void 0,oe.value=!0},ge=async()=>{if(_e.value=await Y(),!(_e.value.length>0))return b.warning("请先选择数据");re.value="重置密码并发送邮件",ne.value="email",ue.value=void 0,oe.value=!0},he=async()=>{const e=i(pe),a=await(null==e?void 0:e.submit());if(a){de.value=!0;try{const e=t({});"add"===ne.value?(e.value=await x(a),e.value&&(oe.value=!1,K())):"edit"===ne.value&&(e.value=await k(a),e.value&&(oe.value=!1,K()))}finally{de.value=!1}}};return(e,a)=>{const t=u("hasPermi");return d(),m(o,null,[s(i(G),null,{default:c((()=>[s(i(A),{schema:ae,onReset:le,onSearch:le},null,8,["schema"]),s(i(S),{"current-page":i(H),"onUpdate:currentPage":a[2]||(a[2]=e=>v(H)?H.value=e:null),"page-size":i(F),"onUpdate:pageSize":a[3]||(a[3]=e=>v(F)?F.value=e:null),showAction:"",columns:ee,"default-expand-all":"","node-key":"id",data:i(T),loading:i($),pagination:{total:i(B)},onRegister:i(W),onRefresh:i(K)},{toolbar:c((()=>[s(i(z),{gutter:10},{default:c((()=>[r((d(),_(i(R),{span:1.5},{default:c((()=>[s(i(C),{type:"primary",onClick:ce},{default:c((()=>[n("新增用户")])),_:1})])),_:1})),[[t,["auth.user.create"]]]),r((d(),_(i(R),{span:1.5},{default:c((()=>[s(i(C),{onClick:ve},{default:c((()=>[n("批量导入用户")])),_:1})])),_:1})),[[t,["auth.user.import"]]]),r((d(),_(i(R),{span:1.5},{default:c((()=>[s(i(C),{onClick:a[0]||(a[0]=e=>i(Z)())},{default:c((()=>[n("导出筛选用户")])),_:1})])),_:1})),[[t,["auth.user.export"]]]),r((d(),_(i(R),{span:1.5},{default:c((()=>[s(i(C),{onClick:fe},{default:c((()=>[n("重置密码通知短信")])),_:1})])),_:1})),[[t,["auth.user.reset"]]]),r((d(),_(i(R),{span:1.5},{default:c((()=>[s(i(C),{onClick:ge},{default:c((()=>[n("重置密码通知邮件")])),_:1})])),_:1})),[[t,["auth.user.reset"]]]),r((d(),_(i(R),{span:1.5},{default:c((()=>[s(i(C),{type:"danger",onClick:a[1]||(a[1]=e=>ie(null))},{default:c((()=>[n("批量删除")])),_:1})])),_:1})),[[t,["auth.user.delete"]]])])),_:1})])),_:1},8,["current-page","page-size","columns","data","loading","pagination","onRegister","onRefresh"])])),_:1}),s(i(D),{modelValue:oe.value,"onUpdate:modelValue":a[5]||(a[5]=e=>oe.value=e),title:re.value,height:600,width:"sms"===ne.value||"email"===ne.value?"1000px":"700px"},f({default:c((()=>["add"===ne.value||"edit"===ne.value?(d(),_(U,{key:0,ref_key:"writeRef",ref:pe,"current-row":ue.value},null,8,["current-row"])):"import"===ne.value?(d(),_(V,{key:1,onGetList:i(K)},null,8,["onGetList"])):"sms"===ne.value?(d(),_(M,{key:2,selections:_e.value,onGetList:i(K)},null,8,["selections","onGetList"])):"email"===ne.value?(d(),_(N,{key:3,selections:_e.value,onGetList:i(K)},null,8,["selections","onGetList"])):h("",!0)])),_:2},["add"===ne.value||"edit"===ne.value?{name:"footer",fn:c((()=>[s(i(C),{type:"primary",loading:de.value,onClick:he},{default:c((()=>[n(g(i(O)("exampleDemo.save")),1)])),_:1},8,["loading"]),s(i(C),{onClick:a[4]||(a[4]=e=>oe.value=!1)},{default:c((()=>[n(g(i(O)("dialogDemo.close")),1)])),_:1})])),key:"0"}:void 0]),1032,["modelValue","title","width"])],64)}}});export{O as default};
