import{u as e,F as s}from"./useForm-ecbcdb43.js";import{u as o}from"./useValidator-e352e7a8.js";import{e as t,K as r,M as a,x as i,N as l,a3 as p,r as n,P as m,o as u,l as c,m as d,k as f}from"./index-9da7d198.js";import{E as j}from"./el-button-8f21380c.js";import{_ as v}from"./ContentWrap.vue_vue_type_script_setup_true_lang-9c7e578a.js";import{a as _,b as g,p as y,c as b}from"./issue-bdbecac5.js";import"./el-col-d9273186.js";import"./el-tooltip-4ed993c7.js";import"./el-popper-2fae9050.js";import"./isNil-1f22f7b0.js";import"./index-cde97138.js";import"./use-form-common-props-9d083c67.js";import"./el-input-26eda071.js";import"./event-5568c9d8.js";import"./use-form-item-8b7f5d34.js";import"./el-tag-aef2ce12.js";import"./index-13d6a136.js";import"./el-checkbox-group-b617b779.js";import"./el-date-picker-f32b0b71.js";import"./debounce-778af7ed.js";import"./el-switch-7720805d.js";import"./el-divider-fc00d058.js";import"./el-progress-69812d34.js";import"./style.css_vue_type_style_index_0_src_true_lang-0e7f3b44.js";import"./index-14d9f390.js";import"./strings-e2e316bd.js";import"./index-4dbb39b8.js";import"./el-card-5fa288fa.js";const w=t({name:"HelpIssueForm",__name:"Write",setup(t,{expose:w}){const{required:h}=o(),{push:P,currentRoute:x}=r(),k={customAlert:(e,s)=>{switch(s){case"success":m.success(e);break;case"info":default:m.info(e);break;case"warning":m.warning(e);break;case"error":m.error(e)}},autoFocus:!1,scroll:!0,readOnly:!1,uploadImgShowBase64:!0,placeholder:"请输入内容..."},I=a([{field:"title",label:"标题名称",component:"Input",colProps:{span:24},componentProps:{style:{width:"100%"}},formItemProps:{rules:[h()]}},{field:"content",label:"内容",colProps:{span:24},component:"Editor",componentProps:{style:{width:"100%"},editorConfig:k,editorId:"issueContent"},formItemProps:{rules:[h()]}},{field:"category_id",label:"问题类别",colProps:{span:24},component:"Select",componentProps:{style:{width:"100%"}},formItemProps:{rules:[h()]},optionApi:async()=>(await _()).data},{field:"",label:"",colProps:{span:24},formItemProps:{slots:{default:()=>i(p,null,[i(j,{loading:A.value,type:"primary",onClick:M},{default:()=>[l("立即保存")]})])}}}]),{formRegister:F,formMethods:C}=e(),{getFormData:E,getElFormExpose:R,setValues:q}=C,N=n(""),A=n(!1);(async()=>{const e=x.value.query.id;if(e){N.value="edit";const s=await b(Number(e));s?q(s.data):P("/404")}else N.value="add"})();const M=async()=>{const e=await R();if(await(null==e?void 0:e.validate())){A.value=!0;const s=await E();if(!s)return A.value=!1,m.error("未获取到数据");const o=n();try{"add"===N.value?(o.value=await g(s),o.value&&(null==e||e.resetFields(),m.success("新增成功"))):"edit"===N.value&&(o.value=await y(s),o.value&&(q(o.value.data),m.success("更新成功")))}finally{A.value=!1}}};return w({submit:M}),(e,o)=>(u(),c(f(v),null,{default:d((()=>[i(f(s),{onRegister:f(F),schema:I,labelPosition:"top"},null,8,["onRegister","schema"])])),_:1}))}});export{w as default};
