import{E as e,u as l,F as a}from"./useForm-ecbcdb43.js";import{u as o}from"./useValidator-e352e7a8.js";import{e as s,r as t,M as n,x as r,a3 as u,w as p,o as d,l as i,k as c,ap as m}from"./index-9da7d198.js";import{E as v}from"./el-tag-aef2ce12.js";import{c as f}from"./menu-519ca870.js";import{e as h}from"./tree-74740d92.js";const b=s({__name:"Write",props:{currentRow:{type:Object,default:()=>null}},setup(s,{expose:b}){const g=s,{required:w}=o();let y=t([]);const x=t(),P={children:"children",label:"label"};let k=t(!1),R=t(!0),_=t(!0);const j=e=>{let l=[];for(let a=0;a<e.length;a++)l.push(e[a].value),e[a].children&&e[a].children.length>0&&(l=l.concat(j(e[a].children)));return l},C=e=>{R.value=e;for(let l=0;l<y.value.length;l++)x.value.store.nodesMap[y.value[l].value].expanded=e},V=e=>{k.value=e,x.value.setCheckedKeys(e?j(y.value):[])},I=n([{field:"name",label:"角色名称",colProps:{span:12},component:"Input"},{field:"role_key",label:"权限字符",colProps:{span:12},component:"Input"},{field:"disabled",label:"角色状态",colProps:{span:12},component:"RadioGroup",componentProps:{style:{width:"100%"},options:[{label:"正常",value:!1},{label:"禁用",value:!0}]},value:!1},{field:"is_admin",label:"最高权限",colProps:{span:12},component:"RadioGroup",componentProps:{style:{width:"100%"},options:[{label:"使用",value:!0},{label:"不使用",value:!1}]},value:!1},{field:"order",label:"显示排序",colProps:{span:12},component:"InputNumber",componentProps:{style:{width:"100%"}}},{field:"desc",label:"描述",colProps:{span:12},component:"Input"},{field:"menu_ids",label:"菜单权限",colProps:{span:24},formItemProps:{slots:{default:()=>r(u,null,[r("div",null,[r("div",null,[r(v,{modelValue:R.value,onChange:C,label:"展开/折叠",size:"large"},null),r(v,{modelValue:k.value,onChange:V,label:"全选/全不选",size:"large"},null),r(v,{modelValue:_.value,"onUpdate:modelValue":e=>_.value=e,label:"父子联动",size:"large"},null)]),r("div",{class:"max-h-420px b-1 b-solid b-[#e5e7eb] p-10px overflow-auto"},[r(e,{ref:x,data:y.value,"show-checkbox":!0,"node-key":"value",props:P,"default-expand-all":R.value,"check-strictly":!_.value},null)])])])}}}]),E=n({name:[w()],role_key:[w()],order:[w()]}),{formRegister:F,formMethods:z}=l(),{setValues:K,getFormData:M,getElFormExpose:G}=z;return p((()=>g.currentRow),(e=>{e&&K(e)}),{deep:!0,immediate:!0}),(async()=>{var e;const l=await f();if(l&&(y.value=l.data,await m(),g.currentRow)){const a=g.currentRow.menus.map((e=>e.id)),o=[];h(l.data,(e=>{a.includes(e.value)&&o.push(e.value)}));for(const l of o)null==(e=c(x))||e.setChecked(l,!0,!1)}})(),b({submit:async()=>{var e,l;const a=await G();if(await(null==a?void 0:a.validate())){const a=await M();return a.menu_ids=[...(null==(e=c(x))?void 0:e.getCheckedKeys())||[],...(null==(l=c(x))?void 0:l.getHalfCheckedKeys())||[]],a}}}),(e,l)=>(d(),i(c(a),{rules:E,onRegister:c(F),schema:I},null,8,["rules","onRegister","schema"]))}});export{b as _};
