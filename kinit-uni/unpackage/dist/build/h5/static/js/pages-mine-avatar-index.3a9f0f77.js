(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-mine-avatar-index"],{2124:function(t,n,a){"use strict";var e=a("7352"),o=a.n(e);o.a},"3a41":function(t,n,a){"use strict";var e=a("4ea4");a("4160"),a("b64b"),a("159b"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var o,i,r,p,s,c,u,d,l,h,v,g=e(a("d294")),b=e(a("420a")),f=a("e91f3"),m=(g.default.baseUrl,uni.getSystemInfoSync()),w=m.screenWidth,y=(m.pixelRatio,1),x=100,k=m.screenWidth,P={data:function(){return{imageSrc:b.default.getters.avatar,isShowImg:!1,cropperInitW:w,cropperInitH:w,cropperW:w,cropperH:w,cropperL:0,cropperT:0,transL:0,transT:0,scaleP:0,imageW:0,imageH:0,cutL:0,cutT:0,cutB:w,cutR:"100%",qualityWidth:k,innerAspectRadio:y}},onReady:function(){this.loadImage()},methods:{setData:function(t){var n=this;Object.keys(t).forEach((function(a){n.$set(n.$data,a,t[a])}))},getImage:function(){var t=this;uni.chooseImage({success:function(n){t.setData({imageSrc:n.tempFilePaths[0]}),t.loadImage()}})},loadImage:function(){var t=this;uni.getImageInfo({src:t.imageSrc,success:function(n){l=1,l>=1?(h=w,v=w/l):(h=w*l,v=w);var a=h>v?h:v;if(x=a>x?x:a,l>=1){var e=Math.ceil((w/l-(w/l-x))/2),o=e,i=Math.ceil((w-w+x)/2),r=i;t.setData({cropperW:w,cropperH:w/l,cropperL:Math.ceil((w-w)/2),cropperT:Math.ceil((w-w/l)/2),cutL:i,cutT:e,cutR:r,cutB:o,imageW:h,imageH:v,scaleP:h/w,qualityWidth:k,innerAspectRadio:l})}else{var p=Math.ceil((w*l-w*l)/2),s=p,c=Math.ceil((w-x)/2),u=c;t.setData({cropperW:w*l,cropperH:w,cropperL:Math.ceil((w-w*l)/2),cropperT:Math.ceil((w-w)/2),cutL:p,cutT:c,cutR:s,cutB:u,imageW:h,imageH:v,scaleP:h/w,qualityWidth:k,innerAspectRadio:l})}t.setData({isShowImg:!0}),uni.hideLoading()}})},contentStartMove:function(t){o=t.touches[0].pageX,i=t.touches[0].pageY},contentMoveing:function(t){var n=(o-t.touches[0].pageX)*y,a=(i-t.touches[0].pageY)*y;n>0?this.cutL-n<0&&(n=this.cutL):this.cutR+n<0&&(n=-this.cutR),a>0?this.cutT-a<0&&(a=this.cutT):this.cutB+a<0&&(a=-this.cutB),this.setData({cutL:this.cutL-n,cutT:this.cutT-a,cutR:this.cutR+n,cutB:this.cutB+a}),o=t.touches[0].pageX,i=t.touches[0].pageY},contentTouchEnd:function(){},getImageInfo:function(){var t=this;uni.showLoading({title:"图片生成中..."});var n=uni.createCanvasContext("myCanvas");n.drawImage(t.imageSrc,0,0,h,v),n.draw(!0,(function(){var n=(t.cropperW-t.cutL-t.cutR)/t.cropperW*h,a=(t.cropperH-t.cutT-t.cutB)/t.cropperH*v,e=t.cutL/t.cropperW*h,o=t.cutT/t.cropperH*v;uni.canvasToTempFilePath({x:e,y:o,width:n,height:a,destWidth:n,destHeight:a,quality:.5,canvasId:"myCanvas",success:function(t){uni.hideLoading(),(0,f.postCurrentUserUploadAvatar)(t.tempFilePath).then((function(t){b.default.commit("SET_AVATAR",t.data),uni.showToast({title:"修改成功",icon:"success"}),uni.navigateBack()}))}})}))},dragStart:function(t){r=t.touches[0].pageX,p=t.touches[0].pageY,s=this.cutL,u=this.cutR,d=this.cutB,c=this.cutT},dragMove:function(t){var n=t.target.dataset.drag;switch(n){case"right":var a=(r-t.touches[0].pageX)*y;u+a<0&&(a=-u),this.setData({cutR:u+a});break;case"left":a=(r-t.touches[0].pageX)*y;s-a<0&&(a=s),s-a>this.cropperW-this.cutR&&(a=s-(this.cropperW-this.cutR)),this.setData({cutL:s-a});break;case"top":a=(p-t.touches[0].pageY)*y;c-a<0&&(a=c),c-a>this.cropperH-this.cutB&&(a=c-(this.cropperH-this.cutB)),this.setData({cutT:c-a});break;case"bottom":a=(p-t.touches[0].pageY)*y;d+a<0&&(a=-d),this.setData({cutB:d+a});break;case"rightBottom":var e=(r-t.touches[0].pageX)*y,o=(p-t.touches[0].pageY)*y;d+o<0&&(o=-d),u+e<0&&(e=-u);var i=d+o,l=u+e;this.setData({cutB:i,cutR:l});break;default:break}}}};n.default=P},"44ff":function(t,n,a){"use strict";a.r(n);var e=a("3a41"),o=a.n(e);for(var i in e)"default"!==i&&function(t){a.d(n,t,(function(){return e[t]}))}(i);n["default"]=o.a},7352:function(t,n,a){var e=a("8bfd");e.__esModule&&(e=e.default),"string"===typeof e&&(e=[[t.i,e,""]]),e.locals&&(t.exports=e.locals);var o=a("4f06").default;o("301edc8a",e,!0,{sourceMap:!1,shadowMode:!1})},"896b":function(t,n,a){"use strict";a.r(n);var e=a("9dd0"),o=a("44ff");for(var i in o)"default"!==i&&function(t){a.d(n,t,(function(){return o[t]}))}(i);a("2124");var r,p=a("f0c5"),s=Object(p["a"])(o["default"],e["b"],e["c"],!1,null,"16b1762b",null,!1,e["a"],r);n["default"]=s.exports},"8bfd":function(t,n,a){var e=a("24fb");n=e(!1),n.push([t.i,'\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/* pages/uni-cropper/index.wxss */.uni-content-info[data-v-16b1762b]{\n\t/* position: fixed;\n\ttop: 0;\n\tleft: 0;\n\tright: 0;\n\tbottom: 0;\n\tdisplay: block;\n\talign-items: center;\n\tflex-direction: column; */}.cropper-config[data-v-16b1762b]{padding:%?20?% %?40?%}.cropper-content[data-v-16b1762b]{min-height:%?750?%;width:100%}.uni-corpper[data-v-16b1762b]{position:relative;overflow:hidden;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none;box-sizing:border-box}.uni-corpper-content[data-v-16b1762b]{position:relative}.uni-corpper-content uni-image[data-v-16b1762b]{display:block;width:100%;min-width:0!important;max-width:none!important;height:100%;min-height:0!important;max-height:none!important;image-orientation:0deg!important;margin:0 auto}\n\n/* 移动图片效果 */.uni-cropper-drag-box[data-v-16b1762b]{position:absolute;top:0;right:0;bottom:0;left:0;cursor:move;background:rgba(0,0,0,.6);z-index:1}\n\n/* 内部的信息 */.uni-corpper-crop-box[data-v-16b1762b]{position:absolute;background:hsla(0,0%,100%,.3);z-index:2}.uni-corpper-crop-box .uni-cropper-view-box[data-v-16b1762b]{position:relative;display:block;width:100%;height:100%;overflow:visible;outline:%?1?% solid #69f;outline-color:rgba(102,153,255,.75)}\n\n/* 横向虚线 */.uni-cropper-dashed-h[data-v-16b1762b]{position:absolute;top:33.33333333%;left:0;width:100%;height:33.33333333%;border-top:%?1?% dashed hsla(0,0%,100%,.5);border-bottom:%?1?% dashed hsla(0,0%,100%,.5)}\n\n/* 纵向虚线 */.uni-cropper-dashed-v[data-v-16b1762b]{position:absolute;left:33.33333333%;top:0;width:33.33333333%;height:100%;border-left:%?1?% dashed hsla(0,0%,100%,.5);border-right:%?1?% dashed hsla(0,0%,100%,.5)}\n\n/* 四个方向的线  为了之后的拖动事件*/.uni-cropper-line-t[data-v-16b1762b]{position:absolute;display:block;width:100%;background-color:#69f;top:0;left:0;height:%?1?%;opacity:.1;cursor:n-resize}.uni-cropper-line-t[data-v-16b1762b]::before{content:"";position:absolute;top:50%;right:%?0?%;width:100%;-webkit-transform:translate3d(0,-50%,0);transform:translate3d(0,-50%,0);bottom:0;height:%?41?%;background:transparent;z-index:11}.uni-cropper-line-r[data-v-16b1762b]{position:absolute;display:block;background-color:#69f;top:0;right:%?0?%;width:%?1?%;opacity:.1;height:100%;cursor:e-resize}.uni-cropper-line-r[data-v-16b1762b]::before{content:"";position:absolute;top:0;left:50%;width:%?41?%;-webkit-transform:translate3d(-50%,0,0);transform:translate3d(-50%,0,0);bottom:0;height:100%;background:transparent;z-index:11}.uni-cropper-line-b[data-v-16b1762b]{position:absolute;display:block;width:100%;background-color:#69f;bottom:0;left:0;height:%?1?%;opacity:.1;cursor:s-resize}.uni-cropper-line-b[data-v-16b1762b]::before{content:"";position:absolute;top:50%;right:%?0?%;width:100%;-webkit-transform:translate3d(0,-50%,0);transform:translate3d(0,-50%,0);bottom:0;height:%?41?%;background:transparent;z-index:11}.uni-cropper-line-l[data-v-16b1762b]{position:absolute;display:block;background-color:#69f;top:0;left:0;width:%?1?%;opacity:.1;height:100%;cursor:w-resize}.uni-cropper-line-l[data-v-16b1762b]::before{content:"";position:absolute;top:0;left:50%;width:%?41?%;-webkit-transform:translate3d(-50%,0,0);transform:translate3d(-50%,0,0);bottom:0;height:100%;background:transparent;z-index:11}.uni-cropper-point[data-v-16b1762b]{width:%?5?%;height:%?5?%;background-color:#69f;opacity:.75;position:absolute;z-index:3}.point-t[data-v-16b1762b]{top:%?-3?%;left:50%;margin-left:%?-3?%;cursor:n-resize}.point-tr[data-v-16b1762b]{top:%?-3?%;left:100%;margin-left:%?-3?%;cursor:n-resize}.point-r[data-v-16b1762b]{top:50%;left:100%;margin-left:%?-3?%;margin-top:%?-3?%;cursor:n-resize}.point-rb[data-v-16b1762b]{left:100%;top:100%;-webkit-transform:translate3d(-50%,-50%,0);transform:translate3d(-50%,-50%,0);cursor:n-resize;width:%?36?%;height:%?36?%;background-color:#69f;position:absolute;z-index:1112;opacity:1}.point-b[data-v-16b1762b]{left:50%;top:100%;margin-left:%?-3?%;margin-top:%?-3?%;cursor:n-resize}.point-bl[data-v-16b1762b]{left:0;top:100%;margin-left:%?-3?%;margin-top:%?-3?%;cursor:n-resize}.point-l[data-v-16b1762b]{left:0;top:50%;margin-left:%?-3?%;margin-top:%?-3?%;cursor:n-resize}.point-lt[data-v-16b1762b]{left:0;top:0;margin-left:%?-3?%;margin-top:%?-3?%;cursor:n-resize}\n\n/* 裁剪框预览内容 */.uni-cropper-viewer[data-v-16b1762b]{position:relative;width:100%;height:100%;overflow:hidden}.uni-cropper-viewer uni-image[data-v-16b1762b]{position:absolute;z-index:2}',""]),t.exports=n},"9dd0":function(t,n,a){"use strict";var e;a.d(n,"b",(function(){return o})),a.d(n,"c",(function(){return i})),a.d(n,"a",(function(){return e}));var o=function(){var t=this,n=t.$createElement,a=t._self._c||n;return a("v-uni-view",{staticClass:"container"},[a("v-uni-view",{staticClass:"page-body uni-content-info"},[a("v-uni-view",{staticClass:"cropper-content"},[t.isShowImg?a("v-uni-view",{staticClass:"uni-corpper",style:"width:"+t.cropperInitW+"px;height:"+t.cropperInitH+"px;background:#000"},[a("v-uni-view",{staticClass:"uni-corpper-content",style:"width:"+t.cropperW+"px;height:"+t.cropperH+"px;left:"+t.cropperL+"px;top:"+t.cropperT+"px"},[a("v-uni-image",{style:"width:"+t.cropperW+"px;height:"+t.cropperH+"px",attrs:{src:t.imageSrc}}),a("v-uni-view",{staticClass:"uni-corpper-crop-box",style:"left:"+t.cutL+"px;top:"+t.cutT+"px;right:"+t.cutR+"px;bottom:"+t.cutB+"px",on:{touchstart:function(n){n.stopPropagation(),arguments[0]=n=t.$handleEvent(n),t.contentStartMove.apply(void 0,arguments)},touchmove:function(n){n.stopPropagation(),arguments[0]=n=t.$handleEvent(n),t.contentMoveing.apply(void 0,arguments)},touchend:function(n){n.stopPropagation(),arguments[0]=n=t.$handleEvent(n),t.contentTouchEnd.apply(void 0,arguments)}}},[a("v-uni-view",{staticClass:"uni-cropper-view-box"},[a("v-uni-view",{staticClass:"uni-cropper-dashed-h"}),a("v-uni-view",{staticClass:"uni-cropper-dashed-v"}),a("v-uni-view",{staticClass:"uni-cropper-line-t",attrs:{"data-drag":"top"},on:{touchstart:function(n){n.stopPropagation(),arguments[0]=n=t.$handleEvent(n),t.dragStart.apply(void 0,arguments)},touchmove:function(n){n.stopPropagation(),arguments[0]=n=t.$handleEvent(n),t.dragMove.apply(void 0,arguments)}}}),a("v-uni-view",{staticClass:"uni-cropper-line-r",attrs:{"data-drag":"right"},on:{touchstart:function(n){n.stopPropagation(),arguments[0]=n=t.$handleEvent(n),t.dragStart.apply(void 0,arguments)},touchmove:function(n){n.stopPropagation(),arguments[0]=n=t.$handleEvent(n),t.dragMove.apply(void 0,arguments)}}}),a("v-uni-view",{staticClass:"uni-cropper-line-b",attrs:{"data-drag":"bottom"},on:{touchstart:function(n){n.stopPropagation(),arguments[0]=n=t.$handleEvent(n),t.dragStart.apply(void 0,arguments)},touchmove:function(n){n.stopPropagation(),arguments[0]=n=t.$handleEvent(n),t.dragMove.apply(void 0,arguments)}}}),a("v-uni-view",{staticClass:"uni-cropper-line-l",attrs:{"data-drag":"left"},on:{touchstart:function(n){n.stopPropagation(),arguments[0]=n=t.$handleEvent(n),t.dragStart.apply(void 0,arguments)},touchmove:function(n){n.stopPropagation(),arguments[0]=n=t.$handleEvent(n),t.dragMove.apply(void 0,arguments)}}}),a("v-uni-view",{staticClass:"uni-cropper-point point-t",attrs:{"data-drag":"top"},on:{touchstart:function(n){n.stopPropagation(),arguments[0]=n=t.$handleEvent(n),t.dragStart.apply(void 0,arguments)},touchmove:function(n){n.stopPropagation(),arguments[0]=n=t.$handleEvent(n),t.dragMove.apply(void 0,arguments)}}}),a("v-uni-view",{staticClass:"uni-cropper-point point-tr",attrs:{"data-drag":"topTight"}}),a("v-uni-view",{staticClass:"uni-cropper-point point-r",attrs:{"data-drag":"right"},on:{touchstart:function(n){n.stopPropagation(),arguments[0]=n=t.$handleEvent(n),t.dragStart.apply(void 0,arguments)},touchmove:function(n){n.stopPropagation(),arguments[0]=n=t.$handleEvent(n),t.dragMove.apply(void 0,arguments)}}}),a("v-uni-view",{staticClass:"uni-cropper-point point-rb",attrs:{"data-drag":"rightBottom"},on:{touchstart:function(n){n.stopPropagation(),arguments[0]=n=t.$handleEvent(n),t.dragStart.apply(void 0,arguments)},touchmove:function(n){n.stopPropagation(),arguments[0]=n=t.$handleEvent(n),t.dragMove.apply(void 0,arguments)}}}),a("v-uni-view",{staticClass:"uni-cropper-point point-b",attrs:{"data-drag":"bottom"},on:{touchstart:function(n){n.stopPropagation(),arguments[0]=n=t.$handleEvent(n),t.dragStart.apply(void 0,arguments)},touchmove:function(n){n.stopPropagation(),arguments[0]=n=t.$handleEvent(n),t.dragMove.apply(void 0,arguments)},touchend:function(n){n.stopPropagation(),arguments[0]=n=t.$handleEvent(n),t.dragEnd.apply(void 0,arguments)}}}),a("v-uni-view",{staticClass:"uni-cropper-point point-bl",attrs:{"data-drag":"bottomLeft"}}),a("v-uni-view",{staticClass:"uni-cropper-point point-l",attrs:{"data-drag":"left"},on:{touchstart:function(n){n.stopPropagation(),arguments[0]=n=t.$handleEvent(n),t.dragStart.apply(void 0,arguments)},touchmove:function(n){n.stopPropagation(),arguments[0]=n=t.$handleEvent(n),t.dragMove.apply(void 0,arguments)}}}),a("v-uni-view",{staticClass:"uni-cropper-point point-lt",attrs:{"data-drag":"leftTop"}})],1)],1)],1)],1):t._e()],1),a("v-uni-view",{staticClass:"cropper-config"},[a("v-uni-button",{staticStyle:{"margin-top":"30rpx"},attrs:{type:"primary reverse"},on:{click:function(n){arguments[0]=n=t.$handleEvent(n),t.getImage.apply(void 0,arguments)}}},[t._v("选择头像")]),a("v-uni-button",{staticStyle:{"margin-top":"30rpx"},attrs:{type:"warn"},on:{click:function(n){arguments[0]=n=t.$handleEvent(n),t.getImageInfo.apply(void 0,arguments)}}},[t._v("提交")])],1),a("v-uni-canvas",{style:"position:absolute;border: 1px solid red; width:"+t.imageW+"px;height:"+t.imageH+"px;top:-9999px;left:-9999px;",attrs:{"canvas-id":"myCanvas"}})],1)],1)},i=[]},e91f3:function(t,n,a){"use strict";var e=a("4ea4");Object.defineProperty(n,"__esModule",{value:!0}),n.updateCurrentUser=i,n.postCurrentUserResetPassword=r,n.postCurrentUserUploadAvatar=p;var o=e(a("bd7f"));function i(t){return o.default.post("/vadmin/auth/user/current/update/info/",t)}function r(t){return o.default.post("/vadmin/auth/user/current/reset/password/",t)}function p(t){return o.default.upload("/vadmin/auth/user/current/update/avatar/",{filePath:t,name:"file"})}}}]);