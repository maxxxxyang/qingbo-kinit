(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/mine/avatar/index"],{232:function(t,e,c){"use strict";(function(t,e){var a=c(4);c(26);a(c(25));var n=a(c(233));t.__webpack_require_UNI_MP_PLUGIN__=c,e(n.default)}).call(this,c(1)["default"],c(2)["createPage"])},233:function(t,e,c){"use strict";c.r(e);var a=c(234),n=c(236);for(var r in n)["default"].indexOf(r)<0&&function(t){c.d(e,t,(function(){return n[t]}))}(r);c(239);var i,u=c(32),s=Object(u["default"])(n["default"],a["render"],a["staticRenderFns"],!1,null,null,null,!1,a["components"],i);s.options.__file="pages/mine/avatar/index.vue",e["default"]=s.exports},234:function(t,e,c){"use strict";c.r(e);var a=c(235);c.d(e,"render",(function(){return a["render"]})),c.d(e,"staticRenderFns",(function(){return a["staticRenderFns"]})),c.d(e,"recyclableRender",(function(){return a["recyclableRender"]})),c.d(e,"components",(function(){return a["components"]}))},235:function(t,e,c){"use strict";var a;c.r(e),c.d(e,"render",(function(){return n})),c.d(e,"staticRenderFns",(function(){return i})),c.d(e,"recyclableRender",(function(){return r})),c.d(e,"components",(function(){return a}));var n=function(){var t=this,e=t.$createElement;t._self._c},r=!1,i=[];n._withStripped=!0},236:function(t,e,c){"use strict";c.r(e);var a=c(237),n=c.n(a);for(var r in a)["default"].indexOf(r)<0&&function(t){c.d(e,t,(function(){return a[t]}))}(r);e["default"]=n.a},237:function(t,e,c){"use strict";(function(t){var a=c(4);Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n,r,i,u,s,o,h,p,d,f,l,g=a(c(38)),v=a(c(33)),m=c(238),R=(g.default.baseUrl,t.getSystemInfoSync()),T=R.screenWidth,I=(R.pixelRatio,1),b=100,L=R.screenWidth,W={data:function(){return{imageSrc:v.default.getters.avatar,isShowImg:!1,cropperInitW:T,cropperInitH:T,cropperW:T,cropperH:T,cropperL:0,cropperT:0,transL:0,transT:0,scaleP:0,imageW:0,imageH:0,cutL:0,cutT:0,cutB:T,cutR:"100%",qualityWidth:L,innerAspectRadio:I}},onReady:function(){this.loadImage()},methods:{setData:function(t){var e=this;Object.keys(t).forEach((function(c){e.$set(e.$data,c,t[c])}))},getImage:function(){var e=this;t.chooseImage({success:function(t){e.setData({imageSrc:t.tempFilePaths[0]}),e.loadImage()}})},loadImage:function(){var e=this;t.getImageInfo({src:e.imageSrc,success:function(c){d=1,d>=1?(f=T,l=T/d):(f=T*d,l=T);var a=f>l?f:l;if(b=a>b?b:a,d>=1){var n=Math.ceil((T/d-(T/d-b))/2),r=n,i=Math.ceil((T-T+b)/2),u=i;e.setData({cropperW:T,cropperH:T/d,cropperL:Math.ceil((T-T)/2),cropperT:Math.ceil((T-T/d)/2),cutL:i,cutT:n,cutR:u,cutB:r,imageW:f,imageH:l,scaleP:f/T,qualityWidth:L,innerAspectRadio:d})}else{var s=Math.ceil((T*d-T*d)/2),o=s,h=Math.ceil((T-b)/2),p=h;e.setData({cropperW:T*d,cropperH:T,cropperL:Math.ceil((T-T*d)/2),cropperT:Math.ceil((T-T)/2),cutL:s,cutT:h,cutR:o,cutB:p,imageW:f,imageH:l,scaleP:f/T,qualityWidth:L,innerAspectRadio:d})}e.setData({isShowImg:!0}),t.hideLoading()}})},contentStartMove:function(t){n=t.touches[0].pageX,r=t.touches[0].pageY},contentMoveing:function(t){var e=(n-t.touches[0].pageX)*I,c=(r-t.touches[0].pageY)*I;e>0?this.cutL-e<0&&(e=this.cutL):this.cutR+e<0&&(e=-this.cutR),c>0?this.cutT-c<0&&(c=this.cutT):this.cutB+c<0&&(c=-this.cutB),this.setData({cutL:this.cutL-e,cutT:this.cutT-c,cutR:this.cutR+e,cutB:this.cutB+c}),n=t.touches[0].pageX,r=t.touches[0].pageY},contentTouchEnd:function(){},getImageInfo:function(){var e=this;t.showLoading({title:"图片生成中..."}),t.getImageInfo({src:e.imageSrc,success:function(c){var a=t.createCanvasContext("myCanvas");a.drawImage(c.path,0,0,f,l),a.draw(!0,(function(){var c=(e.cropperW-e.cutL-e.cutR)/e.cropperW*f,a=(e.cropperH-e.cutT-e.cutB)/e.cropperH*l,n=e.cutL/e.cropperW*f,r=e.cutT/e.cropperH*l;t.canvasToTempFilePath({x:n,y:r,width:c,height:a,destWidth:c,destHeight:a,quality:.5,canvasId:"myCanvas",success:function(e){t.hideLoading(),(0,m.postCurrentUserUploadAvatar)(e.tempFilePath).then((function(e){v.default.commit("auth/SET_AVATAR",e.data),t.showToast({title:"修改成功",icon:"success"}),t.navigateBack()}))}})}))}})},dragStart:function(t){i=t.touches[0].pageX,u=t.touches[0].pageY,s=this.cutL,h=this.cutR,p=this.cutB,o=this.cutT},dragMove:function(t){var e=t.target.dataset.drag,c=void 0,a=void 0,n=void 0;switch(e){case"right":c=(i-t.touches[0].pageX)*I,h+c<0&&(c=-h),this.setData({cutR:h+c});break;case"left":c=(i-t.touches[0].pageX)*I,s-c<0&&(c=s),s-c>this.cropperW-this.cutR&&(c=s-(this.cropperW-this.cutR)),this.setData({cutL:s-c});break;case"top":c=(u-t.touches[0].pageY)*I,o-c<0&&(c=o),o-c>this.cropperH-this.cutB&&(c=o-(this.cropperH-this.cutB)),this.setData({cutT:o-c});break;case"bottom":c=(u-t.touches[0].pageY)*I,p+c<0&&(c=-p),this.setData({cutB:p+c});break;case"rightBottom":a=(i-t.touches[0].pageX)*I,n=(u-t.touches[0].pageY)*I,p+n<0&&(n=-p),h+a<0&&(a=-h),this.setData({cutB:p+n,cutR:h+a});break;default:break}}}};e.default=W}).call(this,c(2)["default"])},239:function(t,e,c){"use strict";c.r(e);var a=c(240),n=c.n(a);for(var r in a)["default"].indexOf(r)<0&&function(t){c.d(e,t,(function(){return a[t]}))}(r);e["default"]=n.a},240:function(t,e,c){}},[[232,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../../.sourcemap/mp-weixin/pages/mine/avatar/index.js.map